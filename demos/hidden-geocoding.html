<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Map Demo with Hidden Geocoding - SetMap jQuery Plugin</title>
		<link href="../css/main.css" rel="stylesheet"/>
	</head>
	<body>
		<form id="map-form" method="POST" action="">
			<input type="hidden" id="location" name="location" tabindex="3" value="New York" />
			<div id="form-map" class="css-map"></div>
			<input type="hidden" name="lat" id="lat" value="40.733" />
			<input type="hidden" name="lng" id="lng" value="-74.007" />
			<p>Move the marker to see what would be sent to ther server upon form submitting!</p>
		</form>
		<!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
		<script>window.jQuery || document.write('<script src="../js/libs/jquery-1.6.4.min.js"><\/script>')</script>
		<script src="http://maps.googleapis.com/maps/api/js?language=en&sensor=false&region=US"></script>
		<script defer src="../js/setmap.min.js"></script>
		<script>
			$(function () {
				$('#form-map').setmap({
					drop: function ( latitude, longitude, fullAddress ) {
						$('#lat').val(latitude);
						$('#lng').val(longitude);
						$('#location').val(fullAddress);
						$('#map-form').trigger('submit');
					},
					marker: {
						position: {
							latitude: 40.733,
							longitude: -74.007
						},
						title: 'New York! New Yoooork!'
					}
				});
				
				$('#searchLoc').bind('click', function () {
					$('#form-map').setmap('setAddress', $('#location').val(), function ( latitude, longitude, fullAddress ) {
						$('#lat').val(latitude);
						$('#lng').val(longitude);
						$('#location').val(fullAddress);
					});
				});
	
				$('#location').bind('keyup', function ( e ) {
					if( e.keyCode === 13 ) {
						$('#searchLoc').trigger('click');
					}
				});
				
				$('#map-form').submit(function ( e ) {
					var data = $(this).serialize();
					e.preventDefault();
					$(this).append('<p>This will be sent to the server: ' + data + '</p>');
					return false;
				});
			});
		</script>
	</body>
</html>
